<!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!-- Here the controller <NotebookCtrl> is not needed because explicitly set in the app.js (route) -->
<!-- Action Bar(Edited) -->
<div ng-if="ticket.principal=='admin'">
    <div id="actionbar" ng-include src="'app/notebook/notebook-actionBar.html?v=1496974691584'"></div>
</div>
<div id="content" class="notebookContent">
    <!-- settings(Edited) -->
    <div ng-if="showSetting && ticket.principal=='admin'" class="setting">
        <div>
            <h4>工作区设置</h4>
        </div>
        <hr>
        <div>
            <h5>插件绑定</h5>
            <p> 为工作区绑定插件，点击给工作区绑定/解除绑定指定插件，拖拉可以重排插件列表顺序。
                <br> 列表的第一个插件是默认插件。需要新建/删除插件，请前往
                <a href="#/interpreter">插件管理</a> 菜单。 </p>
            <div class="interpreterSettings" as-sortable="interpreterSelectionListeners" data-ng-model="interpreterBindings">
                <div data-ng-repeat="item in interpreterBindings" as-sortable-item>
                    <div>
                        <a ng-click="restartInterpreter(item)" ng-class="{'inactivelink': !item.selected}" uib-tooltip="重启">
                            <span class="glyphicon glyphicon-refresh btn-md"></span>
                        </a>&nbsp
                        <div as-sortable-item-handle ng-click="item.selected = !item.selected" class="btn" ng-class="{'btn-info': item.selected, 'btn-default': !item.selected}">
                            <font style="font-size:16px">{{item.name}}</font>
                            <small>
                                <span style="display:inline-block" ng-repeat="intp in item.interpreters">
                                    <span ng-show="!$first">, </span> %
                                    <span ng-show="!$parent.$first || $first">{{item.name}}</span>
                                    <span ng-show="(!$parent.$first || $first) && !$first">.</span>
                                    <span ng-show="!$first">{{intp.name}}</span>
                                    <span ng-show="$parent.$first && $first">(default)</span>
                                </span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div>
            <button class="btn btn-primary" ng-click="saveSetting()">保存</button>
            <button class="btn btn-default" ng-click="closeSetting()">取消</button>
        </div>
    </div>
    <!-- permissions -->
    <div ng-if="showPermissions && ticket.principal && !isAnonymous" class="permissions">
        <div>
            <h4>工作区权限 （仅工作区所有者能进行修改）</h4>
        </div>
        <hr>
        <div>
            <p> 输入逗号用于分割账号或组。
                <br> 输入*号表示任何用户都可以操作。
            </p>
            <div class="permissionsForm" data-ng-model="permissions">
                <p>
                    <span class="owners">所有者 </span>
                    <select id="selectOwners" multiple>
                        <option ng-repeat="owner in permissions.owners" selected>{{owner}} </select> 所有者可以改变权限，包括对工作区做读和写操作。</p>
                <p>
                    <span class="writers">读写权限 </span>
                    <select id="selectWriters" multiple>
                        <option ng-repeat="writers in permissions.writers" selected>{{writers}} </select> 该角色具有读写权限。 </p>
                <p>
                    <span class="readers">读权限 </span>
                    <select id="selectReaders" multiple>
                        <option ng-repeat="readers in permissions.readers" selected>{{readers}} </select> 该角色仅具有读权限。 </p>
            </div>
        </div>
        <br>
        <div>
            <button class="btn btn-primary" ng-click="savePermissions()">保存</button>
            <button class="btn btn-default" ng-click="closePermissions()">取消</button>
        </div>
    </div>
    <div class="note-jump"></div>
    <!-- Include the paragraphs according to the note, pass the note to init function -->
    <div id="{{currentParagraph.id}}_paragraphColumn_main" ng-repeat="currentParagraph in note.paragraphs" ng-controller="ParagraphCtrl"
        ng-init="init(currentParagraph, note)" ng-class="columnWidthClass(currentParagraph.config.colWidth)" style="margin: 0; padding: 0">
        <!-- New Paragraph(Edit) -->
        <div ng-if="ticket.principal=='admin'">
            <div class="new-paragraph" ng-click="insertNew('above')" ng-hide="viewOnly || asIframe || revisionView">
                <h4 class="plus-sign">&#43;</h4>
            </div>
        </div>
        <!-- New Paragraph Column START(Edit) -->
        <div ng-switch='ticket.principal'>
            <div ng-switch-when="admin">
                <div id="{{currentParagraph.id}}_paragraphColumn" ng-include src="'app/notebook/paragraph/paragraph.html?v=1496974691584'"
                    ng-class="{'paragraph-space box paragraph-margin': !asIframe, 'focused': paragraphFocused,
                    'lastEmptyParagraph': !paragraph.text && !paragraph.result}" ng-hide="currentParagraph.config.tableHide && viewOnly"
                    ng-dblclick="paragraphOnDoubleClick(currentParagraph.id);">
                </div>
            </div>
            <div ng-switch-default>
                <div id="{{currentParagraph.id}}_paragraphColumn" ng-include src="'app/notebook/paragraph/paragraph.html?v=1496974691584'"
                    ng-class="{'focused': false,'lastEmptyParagraph': !paragraph.text && !paragraph.result}" ng-hide="currentParagraph.config.tableHide && viewOnly && ticket.principal!='admin'"
                    style='padding-top: 0 !important;padding-bottom: 0 !important;padding: 10px!important;border: 0;min-height: 0;margin-right: 2px;margin-left: 2px;background: #fff;border-radius: 3px;box-shadow: none;'>
                </div>
            </div>
        </div>
        <!-- New Paragraph Column END(Edit) -->
        <div ng-if="ticket.principal=='admin'">
            <div class="new-paragraph" ng-click="insertNew('below');" ng-hide="!$last || viewOnly || asIframe || revisionView">
                <h4 class="plus-sign">&#43;</h4>
            </div>
        </div>
    </div>
    <div style="clear:both;height:10px"></div>
</div>